<html>
<head>
  <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  {% csrf_token %}
  <script>
    $(document).ready(function() {
      $("#week_form").submit(function (e) {
        e.preventDefault();
        var csrf = jQuery("[name=csrfmiddlewaretoken]").val();
        $.ajax({
          url: "/api/admin/week/",
          method: "POST",
          data: {
            'year': $("#year").val(),
            'quarter': $("#quarter").val(),
            'week': $("#week").val()
          },
          headers: {
            'X-CSRFToken': csrf
          }
        }).done(function (response) {
          if(!response.created){
            alert("Week already exists");
          } else {
            alert("Week created");
          }
        });
      });

      $("#data_form").submit(function (e) {
        e.preventDefault();
        var csrf = jQuery("[name=csrfmiddlewaretoken]").val(),
            data = new FormData();
        console.log($('input[name=type]:checked', '#data_form').val())
        console.log($("#selected_week").val())
        data.append('type', $('input[name=type]:checked', '#data_form').val())
        data.append('week', $("#selected_week").val())
        data.append('file', $('#file').get(0).files[0])
        console.log(data)

        $.ajax({
          url: "/api/admin/dataset/",
          method: "POST",
          data: data,
          mimeType: 'multipart/form-data',
          contentType: false,
          processData: false,
          dataTyte: 'json',
          headers: {
            'X-CSRFToken': csrf
          }
        }).done(function (response) {

        });
      });
    });
  </script>
</head>
<body>
<h1>RAD Data Admin</h1>
<div>
  <h2>Week Admin</h2>
  <div>
    <h3>Weeks</h3>
    <table border="1">
      <tr><th>Year</th><th>Quarter</th><th>Week</th></tr>
      {% for week in weeks %}
        <tr><td>{{ week.year }}</td><td>{{ week.get_quarter_display }}</td><td>{{ week.number }}</td></tr>

      {% endfor %}
    </table>

  </div>
  <div>
    <h3>Add New Week</h3>
    <form id="week_form">
      Week Number: <input id="week" minlength="1" maxlength="2">
      Quarter:
      <select id="quarter">
        <option value="4">Autumn</option>
        <option value="1">Winter</option>
        <option value="2">Spring</option>
        <option value="3">Summer</option>
      </select>
      Year: <input id="year" maxlength="4" minlength="4" max="2100">
      <input type="submit" value="Add Week">
    </form>
  </div>
  <div>
    <h2>Data Admin</h2>
    <form id="data_form">
      <input id="file" type="file">
      <br />
      OMAD: <input type="radio" value="1" name="type">
      <br />
      EOP: <input type="radio" value="2" name="type">
      <br />
      International: <input type="radio" value="3" name="type">
      <br />
      <select id="selected_week">
        {% for week in weeks %}
          <option value="{{ week.id }}">{{ week.year }} - {{ week.get_quarter_display }} - Week {{ week.number }}</option>
        {% endfor %}
      </select>
    <input type="submit" value="Add Dataset">
    </form>
  </div>
</div>
</body>
</html>
